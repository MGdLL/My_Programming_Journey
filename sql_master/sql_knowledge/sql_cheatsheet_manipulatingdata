--- TOPICS
-- CASE statements
-- Simple subqueries
-- Correlated subqueries
-- Window functions

-- CASE (to create a new columna whose statement is: if something is x, then y)
  SELECT y,
  CASE  WHEN y = 1  AND y2>1 THEN 'a'      
        WHEN y = 2 AND y2>1 THEN 'b'     
        ELSE 'c' END AS new_column
  FROM x
  WHERE y2=2
  GROUP BY new_column;

  -- you can also enter CASE uses inside WHERE clause
    SELECT *
    FROM x
    WHERE 
        CASE WHEN y > 5 THEN 'Keep'
             WHEN y <= 5 THEN 'Exclude' END = 'z';

  -- you can also use other functions before CASE clause for returning different values to your new column
    SELECT y1, y2,
    COUNT(CASE WHEN y1 = 8650 AND y2 > y3 
          THEN 'z1' END) AS name1,
    COUNT(CASE WHEN y1 = 8650 AND y2 > y3 
          THEN 'z1' END) AS name2,
    FROM x
    GROUP BY name1;

    SELECT y1, y2,
    AVG(CASE WHEN y1 = 8650 AND y2 > y3 
          THEN 'z1' END) AS name1,
    AVG(CASE WHEN y1 = 8650 AND y2 > y3 
          THEN 'z1' END) AS name2,
    FROM x
    GROUP BY name1;

    SELECT y1, y2,
    ROUND(AVG(CASE WHEN y1 = 8650 AND y2 > y3 
          THEN 'z1' END) AS name1,
    ROUND(AVG(CASE WHEN y1 = 8650 AND y2 > y3 
          THEN 'z1' END) AS name2,
    FROM x
    GROUP BY name1;


-- SUBQUERIES (when you do not want to mix data between tables 
-- but you need to filter based in data that there is in another table)
  SELECT y1
  FROM x1
  WHERE y2 NOT IN
       (SELECT DISTINCT y1  FROM x2); 



